// ClipMeter.js - https://github.com/jarvisniu/ClipMeter.js
var global = window || this; global.ClipMeter = function (f) { f = f || {}; var q = f.align || 'right'; var o = f.width || 80; var m = f.height || 40; var e = f.opacity || 0.9; var h = 750; var r = '#363', y = '#040', b = '#080', x = '#8F8'; var l = this; var t = document.createElement('canvas'); var d = t.getContext('2d'); var v = []; var n = 0; var k = 0; var g = 0; var j = -1; var p = 0; var w = -1; var i = []; var a = 0; var c = -1; var u = 0; this.fps = 0; s(); this.start = function () { w = k; k = performance.now(); var A = k - w; a += A; i.push(A); if (i.length > o) { a -= i[0]; i.shift() } }; this.tick = function () { g = performance.now(); if (w > -1) { deltaTime = g - k; var B = k - w; var A = m * (deltaTime / B); v.push(A); n += A; if (v.length > o) { n -= v[0]; v.shift() }z() } }; function s () { t.width = o; t.height = m; t.style.width = o + 'px'; t.style.height = m + 'px'; t.style.border = 'solid 2px ' + r; t.style.position = 'absolute'; t.style[q] = '8px'; t.style.top = '8px'; t.style.opacity = e; d.font = '10px Verdana'; d.textBaseline = 'top'; document.body.appendChild(t) } function z () { var B = v.length, A, E, C = performance.now(); d.fillStyle = y; d.fillRect(0, 0, o, m); d.strokeStyle = b; d.beginPath(); for (var D = 0; D < B; D++) { A = o - B + D + 0.5; d.moveTo(A, m); d.lineTo(A, m - v[D]) }d.stroke(); d.strokeStyle = x; d.beginPath(); for (D = 0; D < B; D++) { A = o - B + D + 0.5; E = m - v[D]; if (D > 0) { d.lineTo(A, E) } else { d.moveTo(A, E) } }d.stroke(); if (o > 31) { d.fillStyle = x; d.textAlign = 'right'; if (C - p > h) { j = Math.floor(n / B / m * 100); p = C } if (j > -1) { d.fillText(j + '%', o - 2, 0) } } if (o > 74) { l.fps = Math.floor(1000 / a * i.length); d.textAlign = 'left'; if (C - u > h) { c = l.fps; u = C } if (c > -1) { d.fillText(c + 'FPS', 2, 0) } } } }
