<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Hit Testing</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="../build/bu.js"></script>
	<link rel="stylesheet" href="css/example.css">
	<script type="text/javascript">
		var bu = new Bu.App({
			renderer: {
				cursor: 'crosshair',
				showKeyPoints: true,
				showBounds: true,
				originAtCenter: true,
			},
			data: {
				mousePos: new Bu.Vector(),
				randomizer: new Bu.ShapeRandomizer(),
			},
			objects: function () {
				var r = this.randomizer.setRange(
					-this.$renderer.width / 2,
					-this.$renderer.height / 2,
					this.$renderer.width,
					this.$renderer.height
				);
				return {
					circle: r.generateCircle().createBounds(),
					ellipse: r.generateEllipse().createBounds(),
					triangle: r.generateTriangle().createBounds(),
					rectangle: r.generateRectangle(),
					fan: r.generateFan().createBounds(),
					bow: r.generateBow().createBounds(),
					polygon: r.generatePolygon().createBounds(),
				};
			},
			init: function () {
				document.querySelector("#btnShowBounds").addEventListener('click', function () {
					bu.$renderer.showBounds = this.checked;
				});

				document.querySelector("#randomize").addEventListener('click', function () {
					bu.regenerateShapes();
				});

				// Hit-testing still works fine after transformations
				this.circle.translate(100, 100).rotate(Bu.d2r(30));
				this.triangle.translate(200, 100).rotate(Bu.d2r(40));

				new Bu.MouseControl(this.$renderer.camera, this.$renderer.dom);
			},
			methods: {
				regenerateShapes: function () {
					this.randomizer.randomize(this.$renderer.scene.children);
				},
			},
			events: {
				mousemove: function (e) {
					var shapes = this.$renderer.scene.children;

					shapes.each(shape => {
						this.mousePos.set(e.offsetX, e.offsetY);

						if (shape.hitTest(this.mousePos))
							shape.style('hover');
						else
							shape.style();
					});
				},
			},
		});

	</script>
</head>
<body>
<div id="info">
	<span>Move the cursor to perform hit-testing.</span>
</div>
<div id="control">
	<button id="randomize">Randomize</button>
	<br>
	<input id="btnShowBounds" type="checkbox" checked>
	<label for="btnShowBounds">Show Bounds</label>
</div>
</body>
</html>
