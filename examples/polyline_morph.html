<!DOCTYPE html>
<html lang="en">
<head>
	<title>Polyline Morph</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta charset="utf-8">
	<script src="../build/bu.js"></script>
	<script src="./lib/morph/PolylineMorph.js"></script>
	<script src="js/ClipMeter.min.js"></script>
	<link rel="stylesheet" href="css/example.css">
	<script type="text/javascript">
		var bu = new Bu.App({
			renderer: {
				showKeyPoints: true,
				cursor: 'crosshair',
			},
			data: {
				time: 0,
				forward: true,
			},
			objects: function () {
				var polylineA = new Bu.Polyline()
					.addPoint(new Bu.Point(100, 300))
					.addPoint(new Bu.Point(250, 100))
					.addPoint(new Bu.Point(400, 300));
				var polylineB = new Bu.Polyline().stroke("red")
					.addPoint(new Bu.Point(100, 400))
					.addPoint(new Bu.Point(250, 350))
					.addPoint(new Bu.Point(400, 400));
				var polylineMorph = new Bu.PolylineMorph(polylineA, polylineB);
				polylineMorph.polyline.stroke("purple");
				var splineA = new Bu.Spline(polylineA);
				var splineB = new Bu.Spline(polylineB).stroke("red");
				var splineM = new Bu.Spline(polylineMorph.polyline).stroke("purple");

				this.polylineMorph = polylineMorph;

				return {
					polylineA: polylineA,
					polylineB: polylineB,
					polylineM: polylineMorph.polyline,
					splineA: splineA,
					splineB: splineB,
					splineM: splineM,
				}
			},
			init: function () {
				this.splineA.visible = this.splineB.visible = this.splineM.visible = false;
				this.$renderer.scene.addChild([this.polylineA, this.polylineB, this.polylineM, this.splineA, this.splineB, this.splineM]);
				this.refreshLabel();
				document.querySelector('#btnPolyline').addEventListener('click', function () {
					bu.toggleSpline(!this.checked);
				});
				document.querySelector('#btnSpline').addEventListener('click', function () {
					bu.toggleSpline(this.checked);
				});
			},
			update: function () {
				if (this.forward) {
					this.time += 0.01;
					if (this.time > 1.2) this.forward = false;
				} else {
					this.time -= 0.01;
					if (this.time < -0.2) this.forward = true;
				}
				this.polylineMorph.setTime(Math.min(1, Math.max(0, this.time)));
			},
			methods: {
				refreshLabel: function () {
					for (var i in this.polylineA.vertices) {
						if (!this.polylineA.vertices.hasOwnProperty(i)) continue;
						this.polylineA.vertices[i].label = i;
					}
					for (i in this.polylineB.vertices) {
						if (!this.polylineB.vertices.hasOwnProperty(i)) continue;
						this.polylineB.vertices[i].label = i;
					}
				},
				toggleSpline: function (isOn) {
					if (isOn) {
						this.polylineA.visible = this.polylineB.visible = this.polylineM.visible = false;
						this.splineA.visible = this.splineB.visible = this.splineM.visible = true;
					} else {
						this.polylineA.visible = this.polylineB.visible = this.polylineM.visible = true;
						this.splineA.visible = this.splineB.visible = this.splineM.visible = false;
					}
				},
			},
			events: {
				mousedown: function (e) {
					var newPoint = new Bu.Point(e.offsetX, e.offsetY);
					if (e.button == 0) {
						this.polylineA.addPoint(newPoint);
					} else {
						this.polylineB.addPoint(newPoint);
					}
					this.refreshLabel();
					this.polylineMorph.update();
				},
			},
		});
	</script>
</head>
<body>
<div id="info">
	<span>Click (left/right button) to add points to the lines.</span>
</div>
<div id="control">
	<div id="switch">
		<div>Line style:</div>
		<input type="radio" name="lineType" id="btnPolyline" checked>
		<label for="btnPolyline">Polyline</label>
		<input type="radio" name="lineType" id="btnSpline">
		<label for="btnSpline">Spline</label>
	</div>
</div>
</body>
</html>
